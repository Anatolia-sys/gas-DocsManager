# 議事録管理アプリ 要件定義書

## 1. プロジェクト概要

Google Apps Script (GAS) を用いた議事録管理Webアプリケーション。
ユーザーのGoogleカレンダーと連携し、会議の議事録作成・管理を効率化する。

## 2. システム構成

| レイヤー | 技術 |
|---|---|
| フロントエンド | HTML + CSS + JavaScript（GAS HtmlService） |
| UIライブラリ | Vue.js 3（CDN版 / petite-vue検討）+ Bootstrap 5（CDN） |
| バックエンド | Google Apps Script |
| データベース | Google スプレッドシート |
| デプロイ形態 | GAS Webアプリ（`doGet` エントリポイント） |
| 開発ツール | clasp（ローカル開発・デプロイ） |
| 外部連携 | Google Calendar API, Google Drive API |

### 2.1 技術選定の理由

- **Vue.js 3 (CDN)**: GAS HtmlService の iframe サンドボックス内で動作可能。リアクティブなUI更新によりSPA的な操作感を実現。petite-vue（6KB）も軽量代替として検討
- **Bootstrap 5**: jQuery不要で軽量。CDN読み込みで導入が容易。レスポンシブ対応済み
- **clasp**: ローカルでのコード管理・バージョン管理・デプロイを効率化

## 3. 機能要件

### 3.1 初回セットアップ（自動プロビジョニング）

- Webアプリ初回アクセス時、ユーザーのマイドライブに管理用フォルダを自動作成する
- フォルダ内に以下のスプレッドシートを自動生成する
  - **議事録データシート**: 議事録の本体データを格納
  - **設定シート**: ユーザー設定（テンプレート選択、カレンダーフィルタ等）を格納
- 作成したスプレッドシートのIDを `PropertiesService.getUserProperties()` に保存し、次回以降の起動で再利用する
- 2回目以降のアクセスではセットアップをスキップする

### 3.2 議事録管理（CRUD）

- **一覧表示**: 議事録の一覧を日付降順で表示する。検索・フィルタ機能を持つ
- **新規作成**: 手動で議事録を新規作成できる。「新規作成」ボタンから作成フォームを表示
- **閲覧**: 議事録の詳細を表示する
- **インライン編集**: 一覧画面から直接ステータス変更やタイトル編集が可能
- **詳細編集**: 編集画面で議事録の全フィールドを編集可能。「保存」「キャンセル」ボタンを配置
- **削除**: 議事録を削除できる（論理削除）。「削除」ボタン押下時に確認ダイアログを表示
- **一括操作**: チェックボックスで複数選択し、一括ステータス変更・一括削除が可能

#### UI操作ボタン

| ボタン | 配置場所 | 動作 |
|---|---|---|
| 新規作成 | 一覧画面上部 | 新規議事録作成フォームを表示 |
| 編集 | 各行のアクションカラム | 詳細編集画面へ遷移 |
| 削除 | 各行のアクションカラム | 確認後に論理削除 |
| 保存 | 編集画面 | 変更を保存して一覧に戻る |
| キャンセル | 編集画面 | 変更を破棄して一覧に戻る |
| カレンダーから取得 | 一覧画面上部 | 当日のカレンダーイベントから手動で議事メモを生成 |
| 一括操作 | 一覧画面上部（選択時表示） | ステータス変更・削除 |

### 3.3 Googleカレンダー連携

- ユーザーのGoogleカレンダーから当日の会議予定を取得する
- カレンダーイベントから以下の情報を抽出する
  - 会議タイトル
  - 開始・終了時刻
  - 参加者一覧
  - 会議の説明（あれば）
  - 会議リンク（Google Meet等）
- 取得対象のカレンダーをユーザーが選択できるようにする

### 3.4 議事メモ自動生成（トリガー）

- 毎朝（時刻はユーザー設定可能）、時間主導型トリガーで実行する
- 当日のカレンダーイベントを取得し、各会議に対して議事メモのフォーマットを自動生成する
- 生成されたメモは議事録データシートに「下書き」ステータスで保存する
- 既に同じイベントIDで議事メモが存在する場合は重複作成しない

### 3.5 テンプレート管理

- 議事メモのフォーマットをテンプレートとして定義できる
- デフォルトテンプレートをシステムが提供する
- ユーザーがカスタムテンプレートを作成・編集・削除できる
- 自動生成時に使用するテンプレートをユーザーが指定できる
- テンプレートにはプレースホルダーを定義できる（例: `{{会議タイトル}}`, `{{日付}}`, `{{参加者}}`）

### 3.6 設定画面

- 自動生成トリガーの実行時刻設定
- 対象カレンダーの選択
- デフォルトテンプレートの選択
- フォルダ・スプレッドシートの再作成（リセット）

## 4. 非機能要件

### 4.1 パフォーマンス目標

| 操作 | 目標レスポンス時間 | 実現手段 |
|---|---|---|
| 画面初期表示 | 1-3秒 | 初期データをscriptletでHTML埋め込み |
| 議事録一覧取得 | 1-2秒 | CacheServiceで結果をキャッシュ（TTL: 5分） |
| 議事録保存 | 1-2秒 | 差分更新（変更行のみ書き込み） |
| カレンダーイベント取得 | 1-3秒 | CacheServiceでキャッシュ（TTL: 10分） |

#### パフォーマンス設計方針

- **CacheService活用**: スプレッドシートの読み込み結果をキャッシュし、APIコールを削減する
- **バッチ読み込み**: データを一括取得し、クライアント側でフィルタ・ソートする
- **初期データ埋め込み**: `doGet` 時にscriptlet (`<?= ?>`) で初期表示データをHTMLに直接埋め込む
- **楽観的UI更新**: 保存操作時はクライアント側を即座に更新し、バックグラウンドでサーバー保存する

### 4.2 GAS固有の制約

| 制約 | 内容 |
|---|---|
| 実行時間制限 | 1回の実行は最大6分 |
| 日次トリガー制限 | 1ユーザーあたり20個まで |
| HTMLサービス | `IFRAME` サンドボックスモードで動作 |
| 通信方式 | `google.script.run` による非同期通信 |

### 4.3 セキュリティ

- OAuthスコープは必要最小限に制限する
- スプレッドシートへのアクセスはユーザー自身のマイドライブ内に限定する
- ユーザーデータは他ユーザーからアクセスできない構成とする

## 5. データ設計

### 5.1 議事録データシート

| カラム | 型 | 説明 |
|---|---|---|
| id | string | UUID |
| eventId | string | GoogleカレンダーのイベントID（手動作成時は空） |
| title | string | 会議タイトル |
| date | date | 会議日 |
| startTime | time | 開始時刻 |
| endTime | time | 終了時刻 |
| attendees | string | 参加者（カンマ区切り） |
| meetingLink | string | 会議リンク |
| templateId | string | 使用テンプレートID |
| content | string | 議事録本文 |
| status | string | draft / completed / archived |
| createdAt | datetime | 作成日時 |
| updatedAt | datetime | 更新日時 |
| deleted | boolean | 論理削除フラグ |

### 5.2 テンプレートシート

| カラム | 型 | 説明 |
|---|---|---|
| id | string | テンプレートID |
| name | string | テンプレート名 |
| body | string | テンプレート本文（プレースホルダー含む） |
| isDefault | boolean | デフォルトテンプレートか |
| createdAt | datetime | 作成日時 |
| updatedAt | datetime | 更新日時 |

### 5.3 設定シート

| カラム | 型 | 説明 |
|---|---|---|
| key | string | 設定キー |
| value | string | 設定値 |

主な設定キー:
- `triggerHour`: トリガー実行時刻（0-23）
- `targetCalendarIds`: 対象カレンダーIDリスト（JSON配列）
- `defaultTemplateId`: デフォルトテンプレートID

## 6. 画面構成

| 画面 | 概要 |
|---|---|
| 初回セットアップ画面 | プロビジョニング中のローディング表示 |
| 議事録一覧画面 | メイン画面。一覧表示・検索・フィルタ |
| 議事録詳細/編集画面 | 議事録の閲覧・編集 |
| テンプレート管理画面 | テンプレートのCRUD |
| 設定画面 | 各種設定 |

## 7. プレースホルダー一覧（テンプレート用）

| プレースホルダー | 展開内容 |
|---|---|
| `{{会議タイトル}}` | カレンダーイベントのタイトル |
| `{{日付}}` | 会議日（YYYY/MM/DD） |
| `{{開始時刻}}` | 開始時刻（HH:MM） |
| `{{終了時刻}}` | 終了時刻（HH:MM） |
| `{{参加者}}` | 参加者一覧 |
| `{{会議リンク}}` | Google Meet等のリンク |
| `{{説明}}` | イベントの説明 |

## 8. デザイン要件

### 8.1 基本方針

- シンプルで見やすいUI。余計な装飾を排除し、情報の視認性を重視する
- Bootstrap 5のコンポーネント（カード、テーブル、モーダル、フォーム）を活用
- レスポンシブデザイン対応（PC・タブレット）

### 8.2 カラースキーム

- ベース: 白背景 + グレー系のアクセント
- プライマリ: Bootstrap のデフォルトブルー
- ステータス表示: draft=warning(黄), completed=success(緑), archived=secondary(灰)

### 8.3 レイアウト

- 上部: ナビゲーションバー（アプリ名、画面切替タブ）
- メイン: コンテンツエリア（各画面のコンポーネントを動的に切替）
- 操作ボタンは画面上部に配置し、常にアクセス可能にする

## 9. 開発・テスト

### 9.1 開発環境

- **clasp** でローカル開発・デプロイを行う
- ディレクトリ構成に従い `.clasp.json` でルートディレクトリを指定

### 9.2 テスト方針

- 各フェーズの実装完了後に clasp push → Webアプリでの動作確認を実施
- 最終フェーズで以下の結合テストを実施する
  - セットアップ → 一覧 → 作成 → 編集 → 削除の一連のフロー
  - カレンダー連携・自動生成トリガーの動作確認
  - エラーケース（スコープ不足、データ不整合等）の確認
  - `clasp push` 時にエラーが出ないことを確認
